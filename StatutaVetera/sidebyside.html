<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statutes of the Realm - Commentary</title>
    <style>
        :root {
            --primary-bg: #1e1e1e;
            --sidebar-bg: #ffffff;
            --accent-color: #0066cc;
            --text-main: #333333;
            --nav-bg: #f0f0f0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background-color: var(--primary-bg);
        }

        .sidebar {
            width: 400px;
            background: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            border-right: 1px solid #ccc;
            box-shadow: 4px 0 10px rgba(0,0,0,0.3);
            z-index: 10;
        }

        /* New Volume Navigation Styles */
        .volume-nav {
            background: var(--nav-bg);
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .volume-nav label {
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: bold;
            color: #666;
            margin-bottom: 2px;
        }

        .vol-links {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .vol-link {
            font-size: 0.75rem;
            text-decoration: none;
            color: var(--accent-color);
            padding: 2px 6px;
            border: 1px solid transparent;
            border-radius: 3px;
        }

        .vol-link:hover {
            background: #e0e0e0;
        }

        .vol-link.active {
            background: var(--accent-color);
            color: white;
            font-weight: bold;
        }

        .sidebar-header {
            padding: 20px;
            background: #f4f4f4;
            border-bottom: 1px solid #ddd;
        }

        .commentary-display {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            color: var(--text-main);
            line-height: 1.6;
        }

        .jump-menu {
            padding: 15px;
            background: #f9f9f9;
            border-top: 1px solid #ddd;
        }

        .jump-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .viewer-container {
            flex: 1;
            padding: 15px;
        }

        iframe {
            width: 100%;
            height: 100%;
            border-radius: 4px;
            border: none;
            background: #fff;
        }

        .btn-jump {
            background: white;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .btn-jump:hover { background: var(--accent-color); color: white; }

        h2 { margin-top: 0; color: #111; font-size: 1.4rem; }
    </style>
</head>
<body>

<aside class="sidebar">
    <nav class="volume-nav">
        <label>Select Volume:</label>
        <div class="vol-links" id="volLinksContainer">
            </div>
    </nav>

    <div class="sidebar-header">
        <h3 style="margin:0">Statutes of the Realm</h3>
        <p id="volLabel" style="margin:5px 0 0; font-size:0.8rem; color:#666;">Loading...</p>
    </div>

    <div class="commentary-display" id="commentaryTarget">
        <p style="color:#888">Select a page to view commentary...</p>
    </div>

    <div class="jump-menu">
        <strong>Annotated Pages:</strong>
        <div class="jump-list" id="jumpLinks">
            Loading...
        </div>
    </div>
</aside>

<main class="viewer-container">
    <iframe id="archiveFrame" src="" allowfullscreen></iframe>
</main>

<script>
    // 1. DATA REGISTRY
    const VOLUMES = {
        "vol1": {
            short: "Vol 1",
            name: "Volume 1: to 1377 (50 Edw. III)",
            id: "statutes-of-the-realm-v-1-1101-1377",
            folder: "commentary1"
        },
        "vol2": {
            short: "Vol 2",
            name: "Volume 2: 1377 (1 Ric. II) to 1509 (19 Hen. VII)",
            id: "statutes-of-the-realm-v-2-1377-1509",
            folder: "commentary2"
        },
        "vol3": {
            short: "Vol 3",
            name: "Volume 3: 1509 (1 Hen. VIII) to 1546-7 (38 Hen. VIII)",
            id: "the-statutes-of-the-realm-3",
            folder: "commentary3"
        },
        "vol4p1": {
            short: "Vol 4.1",
            name: "Volume 4, Part 1: 1547 (1 Edw. VI) to 1584-5 (27 Eliz.)",
            id: "statutesrealm00etcgoog",
            folder: "commentaryp1"
        },
        "vol4p2": {
            short: "Vol 4.2",
            name: "Volume 4, Part 2: 1586 (28 Eliz.) to 1625 (21 Jas. I)",
            id: "statutesrealm01etcgoog",
            folder: "commentary4p2"
        },
        "vol5": {
            short: "Vol 5",
            name: "Volume 5: 1625 (1 Chas. I) to 1680 (32 Chas. II)",
            id: "statutes_of_the_realm_5",
            folder: "commentary5" 
        },
        "vol6": {
            short: "Vol 6",
            name: "Volume 6: 1685 (1 Jas. II) to 1694 (6 & 7 Will. & Mar.)",
            id: "pp63095159",
            folder: "vol6"
        },
        "vol7": {
            short: "Vol 7",
            name: "Volume 7: 1695 (7 & 8 Will. III) to 1701 (13 & 14 Will. III)",
            id: "statutes_of_the_realm_7_placeholder",
            folder: "vol7"
        },
        "vol8": {
            short: "Vol 8",
            name: "Volume 8: 1702 (1 Anne) to 1707 (6 Anne)",
            id: "statutes_of_the_realm_8_placeholder",
            folder: "vol8"
        },
        "vol9": {
            short: "Vol 9",
            name: "Volume 9: 1708 (7 Anne) to 1713 (13 Anne)",
            id: "statutes_of_the_realm_9_placeholder",
            folder: "vol9"
        },
        "vol10": {
            short: "Vol 10",
            name: "Volume 10: Alphabetical Index",
            id: "statutes_of_the_realm_10_placeholder",
            folder: "vol10"
        },
        "vol11": {
            short: "Vol 11",
            name: "Volume 11: Chronological Index",
            id: "statutes_of_the_realm_11_placeholder",
            folder: "vol11"
        }
    };

    // 2. STATE & URL LOGIC
    const params = new URLSearchParams(window.location.search);
    const volKey = params.get('v') || 'vol1'; // Default changed to vol1
    const currentVol = VOLUMES[volKey] || VOLUMES['vol1'];

    // 3. GITHUB CONFIG
    const GITHUB_USER = 'notamitchell';
    const GITHUB_REPO = 'law';
    const PAGES_BASE_URL = `https://${GITHUB_USER}.github.io/${GITHUB_REPO}/${currentVol.folder}`;
    const API_URL = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${currentVol.folder}`;

    const frame = document.getElementById('archiveFrame');
    const display = document.getElementById('commentaryTarget');
    const jumpContainer = document.getElementById('jumpLinks');
    const volLabel = document.getElementById('volLabel');
    const volLinksContainer = document.getElementById('volLinksContainer');

    // 4. INITIALIZE UI
    function initUI() {
        volLabel.innerText = currentVol.name;
        frame.src = `https://archive.org/embed/${currentVol.id}#mode/1up/page/n1`;
        
        // Generate Volume Switcher Links
        Object.keys(VOLUMES).forEach(key => {
            const link = document.createElement('a');
            link.href = `?v=${key}`;
            link.className = `vol-link ${key === volKey ? 'active' : ''}`;
            link.innerText = VOLUMES[key].short;
            volLinksContainer.appendChild(link);
        });
    }

    async function initFromGitHub() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error('No files found');
            const files = await response.json();
            
            const pages = files
                .filter(file => file.name.endsWith('.html'))
                .map(file => parseInt(file.name.replace('.html', '')))
                .sort((a, b) => a - b);

            jumpContainer.innerHTML = '';
            pages.forEach(page => {
                const btn = document.createElement('button');
                btn.className = 'btn-jump';
                btn.innerText = `p. ${page}`;
                btn.onclick = () => goToPage(page);
                jumpContainer.appendChild(btn);
            });
        } catch (error) {
            jumpContainer.innerHTML = '<span style="color:#888; font-size:0.8rem;">No annotations available for this volume yet.</span>';
        }
    }

    async function goToPage(pageNum) {
        const archiveIndex = pageNum - 1;
        frame.src = `https://archive.org/embed/${currentVol.id}#mode/1up/page/n${archiveIndex}`;

        const commentaryUrl = `${PAGES_BASE_URL}/${pageNum}.html`;
        display.innerHTML = `<p style="color:#888">Loading page ${pageNum}...</p>`;

        try {
            const res = await fetch(commentaryUrl);
            if (res.ok) {
                const htmlContent = await res.text();
                display.innerHTML = `
                    <div class="active-note">
                        <small style="color:var(--accent-color); font-weight:bold;">PAGE ${pageNum}</small>
                        <hr style="border:0; border-top:1px solid #eee; margin:10px 0;">
                        ${htmlContent}
                    </div>
                `;
            } else {
                display.innerHTML = `<p style="color:#888">No commentary found for page ${pageNum}.</p>`;
            }
        } catch (err) {
            display.innerHTML = `<p style="color:red">Error loading commentary.</p>`;
        }
    }

    initUI();
    initFromGitHub();
</script>

</body>
</html>
