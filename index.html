<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="generator" content="GitLab Pages">
        <title>eLiebermann: An Online Dictionary of Pre-Conquest English Law</title>

            <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet" />
    
        <style>
            /* styling to make the text editor look nice */
            #editor-container {
                border: 1px solid #ccc;
                height: 300px;
            }

            abbr {
                background-color: yellow;
            }
        </style>

        <link rel="stylesheet" href="style.css">

    </head>
    <body>
        <h1>eLiebermann: An Online Dictionary of Pre-Conquest English Law</h1>
        <p>
          An Online Dictionary of Pre-Conquest English Law.
        </p>
        <p>
            Liebermann, F. (Ed.). (2015). Die Gesetze der Angelsachsen: Herausgegeben im Auftrage der Savigny-Stiftung (Cambridge Library Collection - Medieval History). Cambridge: Cambridge University Press. doi:10.1017/CBO9781316225127
        </p>
        <p>
            https://www.cambridge.org/core/books/die-gesetze-der-angelsachsen/C73464C2D5D364303A2EAFC8708D553D
        </p>
        
        <p>
            Code: <a href="https://github.com/notamitchell/law">https://github.com/notamitchell/law</a><br/>
            Website: <a href="https://notamitchell.github.io/law/">https://notamitchell.github.io/law/</a>

        </p>
        
        <p>
            (A PDF of the relevant book is in the resources folder of this project.) 
        </p>
        
        <hr>
        
        <div>
            <h1>Page Number: </h1>
            <input type="number" id="page_number" /> 
            &nbsp;
            <br>
            
            <h1>Entry text: </h1>


    <div id="editor-container"></div>

   


<p>Bosworth-Toller Link/s:<br>
    <input type="" value="<a href=''></a>" id="bt_link1"/><br>
    <input type="" value="<a href=''></a>" id="bt_link2"/><br>
    <input type="" value="<a href=''></a>" id="bt_link3"/><br>
</p>

<p>Dictionary of Old English Link/s:<br>
    <input type="" value="<a href=''></a>" id="dooe_link1"/><br>
    <input type="" value="<a href=''></a>" id="dooe_link2"/><br>
    <input type="" value="<a href=''></a>" id="dooe_link3"/><br>

</p>

<p>
Wiktionary Link/s:<br>
    <input type="" value="<a href=''></a>" id="wiktionary_link1"/><br>
    <input type="" value="<a href=''></a>" id="wiktionary_link2"/><br>
    <input type="" value="<a href=''></a>" id="wiktionary_link3"/><br>
</p>

<p>
English translation:<br><div id="english-container"></div>
</p>

            <br>
            <input type="button" value="Process" onclick="process_selection();" />
            
<br>
            <div id="output_html_rendered"> </div>

<h1>HTML:</h1>
            <br>
            <textarea id="output_html_raw" rows="5" cols="100" ></textarea>
            
        
            
  <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>

    <script>
        // Define the custom toolbar you want to display.
        // We are keeping it minimal to just bold, italic, and superscript.
        const toolbarOptions = [
          ['bold', 'italic'],
          [{ 'script': 'super' }],
        ];

        // Initialize Quill and configure it to use your custom toolbar
        // and to only allow specific formatting.
        const quill = new Quill('#editor-container', {
          modules: {
            toolbar: toolbarOptions,
          },
          // The 'formats' option acts as a whitelist. Any formatting not listed
          // here will be automatically removed on paste or edit.
          formats: ['bold', 'italic', 'script'],
          theme: 'snow', // The theme from the stylesheet.
        });


        const englishToolbarOptions = [
          ['bold', 'italic'],
          [{ 'script': 'super' }],
        ];

        const quillEnglish = new Quill('#english-container', {
          modules: {
            toolbar: englishToolbarOptions,
          },
          formats: ['bold', 'italic', 'script'],
          theme: 'snow', 
        });


    function escapeRegex(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }


    // JSONP to load markforward such as abbreviations from data folder
    var markforward  = {};
    function markforwardJSONP(jsonObj) {
        markforward = jsonObj;
    }


    // JSONP to load markLaw for law codes from data folder
    var markLaw  = {};
    function markLawJSONP(jsonObj) {
        markLaw = jsonObj;
    }

    console.log(markLaw);

    function process_selection() {
        var output_html = "";
        var entryHTML = quill.root.innerHTML;
        var entry = quill.getText();
        
        //turn into one line
        entry = entry.replace(/\r/g, " ").replace(/\n/g, " ");
        
        var language = whatLanguage(entryHTML);
        var headWord = whatHeadWord(entry);
        var seeAlso = whatSeeAlso(entry);
        
        
        // Replace ~ with headword as tooltip
        entry = entry.replace("~", "<span title='" + headWord + "'>~</span>");
        
        
        output_html += "<h1>" + headWord + "</h1>\n";
        output_html += "<table>\n";
        output_html += "<tr>\n";
        // Headings for the table:
        output_html += "<th>Page Number</th><th>Head Word</th><th>Language</th><th>See Also</th><th>Full Entry</th><th>Liebermann's Definition</th><th>English Translation</th>\n";
        output_html += "</tr>\n";
        output_html += "<tr>\n";
        output_html += "<td>" + document.getElementById("page_number").value + "</td>";
        output_html += "<td>" + headWord + "</td>";
        output_html += "<td>" + language + "</td>";
        output_html += "<td><a href='" + seeAlso + ".html'>" + seeAlso + "</a></td>";
        output_html += "<td>" + entryHTML + "</td>";

        output_html += "<td>" +  parseEnumeratedListAsHtml(entryHTML) + "</td>";

        output_html += "<td>" + quillEnglish.root.innerHTML + "</td>";
        
        output_html += "</tr>\n";
        output_html += "</table>";

        var links = [];

        for (let i = 1; i <= 3; i++) {
            const linkElement = document.getElementById("bt_link" + i);
            if (linkElement) { // Check if the element exists
                const linkValue = linkElement.value;
                if (linkValue !== "<a href=''></a>") {
                    links.push(linkValue);
                }
            }
        }

        if (links.length > 0) {
            output_html += "<ul>";
            for (const link of links) {
                output_html += `<li>Bosworth-Toller: ${link}</li>`;
            }
            output_html += "</ul>";
        }

        links = [];
        for (let i = 1; i <= 3; i++) {
            const linkElement = document.getElementById("dooe_link" + i);
            if (linkElement) { // Check if the element exists
                const linkValue = linkElement.value;
                if (linkValue !== "<a href=''></a>") {
                    links.push(linkValue);
                }
            }
        }

        if (links.length > 0) {
            output_html += "<ul>";
            for (const link of links) {
                output_html += `<li>Dictionary of Old English: ${link}</li>`;
            }
            output_html += "</ul>";
        }

        links = [];
        for (let i = 1; i <= 3; i++) {
            const linkElement = document.getElementById("wiktionary_link" + i);
            if (linkElement) { // Check if the element exists
                const linkValue = linkElement.value;
                if (linkValue !== "<a href=''></a>") {
                    links.push(linkValue);
                }
            }
        }

        if (links.length > 0) {
            output_html += "<ul>";
            for (const link of links) {
                output_html += `<li>Wiktionary: ${link}</li>`;
            }
            output_html += "</ul>";
        }

        for (var i = 0; i < markforward.length; i++) {
            var obj = markforward[i];
            var searchTerm = obj["markforward"];
            var germanExpansion = obj["German Expansion"];

            // Escape any special characters in the search term before creating the regex
            var escapedSearchTerm = escapeRegex(searchTerm);

            var regex = new RegExp('\\b' + escapedSearchTerm + '\\b', 'g');

            output_html = output_html.replace(regex, '<a href="' + encodeURIComponent(searchTerm) + '.html"><abbr title="' + germanExpansion + '">' + searchTerm + '</abbr></a>');
        }

        for (const innerArray of markLaw) {
        //for (var i = 0; i < markLaw.length; i++) {
            var searchTerm = innerArray[0];

            // Escape any special characters in the search term before creating the regex
            var escapedSearchTerm = escapeRegex(searchTerm);

            var regex = new RegExp('\\b' + escapedSearchTerm + '\\b', 'g');

            output_html = output_html.replace(regex, '<a title="Law Code" style="background-color: green;" href="' + encodeURIComponent(searchTerm) + '.html"" >' + searchTerm + '</a>');
        }
        
        
        document.getElementById('output_html_rendered').innerHTML = output_html;
        document.getElementById('output_html_raw').value = "<html><body>" + output_html + "</body></html>";
        
    }
    
    function whatLanguage(htmlString) {
        // Give this function an entry and it will tell you what language it is. 
        // Entries starting with L followd by a space are Latin
        // Entries starting with F followd by a space are French
        // Entries starting with no thing are Old English
        
        const tempElement = document.createElement('div');
        tempElement.innerHTML = htmlString.trim();

        // Get the first child element of the temporary element
        const firstElement = tempElement.firstElementChild;

        // If there's no first element, there's no HTML to check
        if (!firstElement) {
            return 'Old English';
        }

        // Find the first superscript element (<sup>) within the first child element
        const superscriptElement = firstElement.querySelector('sup');

        // If a superscript element exists, get its text content
        if (superscriptElement) {
            const supContent = superscriptElement.textContent.trim();
            if (supContent.includes('L')) {
            return 'Latin';
            }
            if (supContent.includes('F')) {
            return 'French';
            }
        }

        // Default to English if no superscript is found or if the content doesn't match L or F
        return 'Old English';
    }
    
    function whatHeadWord(str) {
        // Give this function an entry and it will tell you what the head word (i.e. the dictionary word of this entry)
        
        if (str.substring(0, 2) == "L ") {
            str = str.substring(2);
        }
        
        if (str.substring(0, 2) == "F ") {
            str = str.substring(2);
        }
        
        return str.split(" ")[0];
        
    }
    
    function whatSeeAlso(str) {
        // The .s indicate a See Also. See another entry. 
        // e.g. abere s. aebaere
        // e.g. localization s. localisation
        
        var n = str.search(" s. ");
        
        
        if (n < 0) {
            return "";
        } else {
            return str.split(" s. ")[1];
        }
        
    }




    function parseEnumeratedListAsHtml(htmlString) {
    // This regex is excellent for the task. It finds the list marker and captures the content.
    //const regex = /<strong>(\d+)<\/strong>\)\s*(.*?)(?=(<strong>|$))/g;
        const regex = /(\d+)<\/strong>\)\s*(.*?)(?=(<strong>|$))/g;
    const listItems = [];
    let match;

    // Loop through all matches in the string.
    while ((match = regex.exec(htmlString)) !== null) {
        // The content is in the second capturing group (match[2]).
        // We trim the content to remove leading/trailing whitespace.
        const content = match[2].trim();
        if (content) {
        listItems.push(content);
        }
    }

    return `<ol>\n${listItems.map(item => `  <li>${item}</li>`).join('\n')}\n</ol>`;;
    }
  
</script>     
<script src="data/markforward.js"></script>
<script src="data/markLaw.js"></script>





    </body>
</html>
